"use strict";(self["webpackChunkcn_dictation"]=self["webpackChunkcn_dictation"]||[]).push([[108],{6108:function(t,i,e){e.r(i),e.d(i,{default:function(){return c}});var s=function(){var t=this,i=t._self._c;return i("div",{staticClass:"main"},[i("div",{staticClass:"page"},[i("div",{staticClass:"py cell_py"}),i("div",{staticClass:"char cell"}),i("canvas",{ref:"write",staticClass:"write"})]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.writing,expression:"!writing"}],staticClass:"btn-wrapper"},[t.step>=0?i("div",{staticClass:"btn",on:{click:t.clear}},[t._v("清空")]):t._e(),t.step>=0?i("div",{staticClass:"btn",on:{click:t.redo}},[t._v("撤销")]):t._e(),0!==t.currentCharIndex?i("div",{staticClass:"btn",on:{click:t.prev}},[t._v("上一个")]):t._e(),t.currentCharIndex!==t.chars.length-1?i("div",{staticClass:"btn",on:{click:t.next}},[t._v("下一个")]):t._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.writing,expression:"!writing"}],staticClass:"btn-wrapper-sub"},[i("div",{staticClass:"btn",on:{click:t.playVoice}},[t._v("播放")]),i("div",{staticClass:"btn"},[t._v(t._s(t.currentCharIndex+1)+" / "+t._s(t.chars.length))]),i("div",{staticClass:"btn",on:{click:t.finish}},[t._v("检查")])])])},r=[],h=(e(560),{data(){return{step:-1,imgList:[],isMobile:!1,writing:!1,currentCharIndex:0,charts_writed:[],audio:null}},mounted(){this.$route.params.book||this.$router.replace({name:"HomeCenter"}),addEventListener("resize",this.resetWriteSize);try{document.createEvent("TouchEvent"),this.isMobile=!0}catch(t){this.isMobile=!1}this.initWrite()},destroyed(){removeEventListener("resize",this.resetWriteSize)},methods:{resetWriteSize(){var t=this.$refs.write;t.width=t.offsetWidth,t.height=t.offsetHeight,this.newestDrawFromHistory()},initWrite(){var t=this.$refs.write,i=t.getContext("2d");this.resetWriteSize();const e=e=>{this.writing=!0;let s=e.offsetX,r=e.offsetY,h=t=>{var e=t.offsetX,h=t.offsetY;i.moveTo(s,r),i.lineTo(e,h),i.strokeStyle="#222222",i.lineWidth=8,i.stroke(),s=e,r=h};this.isMobile?t.onpointermove=h:t.onmousemove=h},s=()=>{t.onmousemove&&this.history(),this.writing=!1,t.onmousemove=null,t.onpointermove=null},r=()=>{t.onmousemove=null,t.onpointermove=null,this.writing=!1,this.history()};this.isMobile?(t.onpointerdown=e,t.onpointerout=s,t.onpointerup=r):(t.onmousedown=e,t.onmouseout=s,t.onmouseup=r),this.playVoice()},redo(){if(this.step>=0){this.step--,this.$refs.write.width=this.$refs.write.offsetWidth;var t=this.$refs.write,i=t.getContext("2d"),e=new Image;e.src=this.imgList[this.step],e.onload=()=>{i.drawImage(e,0,0,this.$refs.write.offsetWidth,this.$refs.write.offsetHeight)}}else alert("没有上一步了")},drawImg(t){var i=new Image;i.width=this.$refs.write.offsetWidth,i.height=this.$refs.write.offsetHeight,i.src=t;var e=this.$refs.write,s=e.getContext("2d");i.onload=()=>{s.drawImage(i,0,0,this.$refs.write.offsetWidth,this.$refs.write.offsetHeight)}},newestDrawFromHistory(){this.drawImg(this.imgList[this.step])},clear(){this.step=-1,this.imgList=[],this.$refs.write.width=this.$refs.write.offsetWidth},history(){this.step++,this.step<this.imgList.length&&(this.imgList.length=this.step),this.imgList.push(this.$refs.write.toDataURL("image/png"))},playVoice(){this.audio&&!this.audio.paused&&(this.audio.pause(),this.audio.currentTime=0,this.audio=null);const t=this.chars[this.currentCharIndex].v;t&&(this.audio=new Audio("./"+t),this.audio.play())},prev(){this.saveCurrent(),this.clear(),this.currentCharIndex--,this.loadCurrentIfExists(),this.playVoice()},next(){this.saveCurrent(),this.clear(),this.currentCharIndex++,this.loadCurrentIfExists(),this.playVoice()},loadCurrentIfExists(){this.charts_writed[this.currentCharIndex]&&(this.imgList=this.charts_writed[this.currentCharIndex].imgList,this.step=this.charts_writed[this.currentCharIndex].step,this.drawImg(this.charts_writed[this.currentCharIndex].writeImg))},saveCurrent(){const t=this.$refs.write.toDataURL("image/png");this.charts_writed[this.currentCharIndex]={char:this.chars[this.currentCharIndex],writeImg:t,imgList:this.imgList,step:this.step}},finish(){this.saveCurrent(),this.$router.replace({name:"ShowResult",params:{result:this.charts_writed}})}},computed:{chars:function(){const t=[];if(!this.$route.params.units)return[];for(const i of this.$route.params.units)t.push(...i.newChars);return t}}}),n=h,a=e(1001),o=(0,a.Z)(n,s,r,!1,null,"4007c888",null),c=o.exports}}]);
//# sourceMappingURL=108.78755d79.js.map