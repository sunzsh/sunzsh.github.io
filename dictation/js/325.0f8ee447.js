"use strict";(self["webpackChunkcn_dictation"]=self["webpackChunkcn_dictation"]||[]).push([[325],{3325:function(t,i,s){s.r(i),s.d(i,{default:function(){return c}});var e=function(){var t=this,i=t._self._c;return i("div",{staticClass:"main"},[i("div",{staticClass:"page"},[i("div",{staticClass:"py cell_py"}),i("div",{staticClass:"char cell"}),i("canvas",{ref:"write",staticClass:"write"})]),i("transition",{attrs:{name:"el-fade-in-linear"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showingBtn,expression:"showingBtn"}],staticClass:"btn-wrapper"},[0!==t.currentCharIndex?i("div",{staticClass:"btn",on:{click:t.prev}},[i("i",{staticClass:"el-icon-back",staticStyle:{transform:"scale(1.5)","font-weight":"bold"}})]):t._e(),t.step>=0?i("div",{staticClass:"btn",on:{click:t.clear}},[i("i",{staticClass:"el-icon-delete-solid"})]):t._e(),t.step>=0?i("div",{staticClass:"btn",on:{click:t.redo}},[t._v("撤销")]):t._e(),t.currentCharIndex!==t.chars.length-1?i("div",{staticClass:"btn",on:{click:t.next}},[i("i",{staticClass:"el-icon-right",staticStyle:{transform:"scale(1.5)","font-weight":"bold"}})]):t._e()])]),i("transition",{attrs:{name:"el-fade-in-linear"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showingBtn,expression:"showingBtn"}],staticClass:"btn-wrapper-sub"},[i("div",{staticClass:"btn",on:{click:function(i){!t.audioLoading&&t.playVoice()}}},[i("i",{class:t.audioLoading?"el-icon-loading":"el-icon-caret-right",staticStyle:{transform:"scale(1.5)"}})]),i("div",{staticClass:"btn"},[t._v(t._s(t.currentCharIndex+1)+" / "+t._s(t.chars.length))]),i("div",{staticClass:"btn",on:{click:t.finish}},[t._v("检查")])])])],1)},r=[],n=(s(560),{data(){return{step:-1,imgList:[],isMobile:!1,writing:!1,currentCharIndex:0,charts_writed:[],audio:null,audioLoading:!1,showingBtn:!0,showingTimeout:null}},watch:{writing(t){t?(this.showingTimeout&&clearTimeout(this.showingTimeout),this.showingBtn=!1):(this.showingTimeout&&clearTimeout(this.showingTimeout),this.showingTimeout=setTimeout((()=>{this.showingBtn=!0,this.showingTimeout=null}),600))}},mounted(){this.$route.params.book||this.$router.replace({name:"HomeCenter"}),addEventListener("resize",this.resetWriteSize);try{document.createEvent("TouchEvent"),this.isMobile=!0}catch(t){this.isMobile=!1}this.initWrite()},destroyed(){removeEventListener("resize",this.resetWriteSize)},methods:{resetWriteSize(){var t=this.$refs.write;t.width=t.offsetWidth,t.height=t.offsetHeight,this.newestDrawFromHistory()},initWrite(){var t=this.$refs.write,i=t.getContext("2d");this.resetWriteSize();const s=s=>{this.writing=!0;let e=s.offsetX,r=s.offsetY,n=t=>{var s=t.offsetX,n=t.offsetY;i.moveTo(e,r),i.lineTo(s,n),i.strokeStyle="#222222",i.lineWidth=8,i.stroke(),e=s,r=n};this.isMobile?t.onpointermove=n:t.onmousemove=n},e=()=>{t.onmousemove&&this.history(),this.writing=!1,t.onmousemove=null,t.onpointermove=null},r=()=>{t.onmousemove=null,t.onpointermove=null,this.writing=!1,this.history()};this.isMobile?(t.onpointerdown=s,t.onpointerout=e,t.onpointerup=r):(t.onmousedown=s,t.onmouseout=e,t.onmouseup=r),this.playVoice()},redo(){if(this.step>=0){this.step--,this.$refs.write.width=this.$refs.write.offsetWidth;var t=this.$refs.write,i=t.getContext("2d"),s=new Image;s.src=this.imgList[this.step],s.onload=()=>{i.drawImage(s,0,0,this.$refs.write.offsetWidth,this.$refs.write.offsetHeight)}}else alert("没有上一步了")},drawImg(t){if(t){var i=new Image;i.width=this.$refs.write.offsetWidth,i.height=this.$refs.write.offsetHeight,i.src=t;var s=this.$refs.write,e=s.getContext("2d");i.onload=()=>{e.drawImage(i,0,0,this.$refs.write.offsetWidth,this.$refs.write.offsetHeight)}}},newestDrawFromHistory(){this.drawImg(this.imgList[this.step])},clear(){this.step=-1,this.imgList=[],this.$refs.write.width=this.$refs.write.offsetWidth},history(){this.step++,this.step<this.imgList.length&&(this.imgList.length=this.step),this.imgList.push(this.$refs.write.toDataURL("image/png"))},playVoice(){this.audio&&!this.audio.paused&&(this.audio.pause(),this.audio.currentTime=0,this.audio=null,this.audioLoading=!1);const t=this.chars[this.currentCharIndex]&&this.chars[this.currentCharIndex].v;t&&(this.audio=new Audio("./"+t),this.audioLoading=!0,this.audio.play().then((()=>{this.audioLoading=!1})).catch((()=>{})))},prev(){this.saveCurrent(),this.clear(),this.currentCharIndex--,this.loadCurrentIfExists(),this.playVoice()},next(){this.saveCurrent(),this.clear(),this.currentCharIndex++,this.loadCurrentIfExists(),this.playVoice()},loadCurrentIfExists(){this.charts_writed[this.currentCharIndex]&&(this.imgList=this.charts_writed[this.currentCharIndex].imgList,this.step=this.charts_writed[this.currentCharIndex].step,this.drawImg(this.charts_writed[this.currentCharIndex].writeImg))},saveCurrent(){const t=this.$refs.write.toDataURL("image/png");this.charts_writed[this.currentCharIndex]={char:this.chars[this.currentCharIndex],writeImg:t,imgList:this.imgList,step:this.step}},finish(){this.saveCurrent(),this.$router.replace({name:"ShowResult",params:{result:this.charts_writed}})}},computed:{chars:function(){const t=[];if(!this.$route.params.units)return[];for(const i of this.$route.params.units)t.push(...i.newChars);return t}}}),a=n,h=s(1001),o=(0,h.Z)(a,e,r,!1,null,"0efa0f65",null),c=o.exports}}]);
//# sourceMappingURL=325.0f8ee447.js.map